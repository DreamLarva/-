"use strict";
/*
363. 矩形区域不超过 K 的最大数值和
给你一个 m x n 的矩阵 matrix 和一个整数 k ，找出并返回矩阵内部矩形区域的不超过 k 的最大数值和。

题目数据保证总会存在一个数值和不超过 k 的矩形区域。



示例 1：


输入：matrix = [[1,0,1],[0,-2,3]], k = 2
输出：2
解释：蓝色边框圈出来的矩形区域 [[0, 1], [-2, 3]] 的数值和是 2，且 2 是不超过 k 的最大数字（k = 2）。
示例 2：

输入：matrix = [[2,2,-1]], k = 3
输出：3


提示：

m == matrix.length
n == matrix[i].length
1 <= m, n <= 100
-100 <= matrix[i][j] <= 100
-105 <= k <= 105


进阶：如果行数远大于列数，该如何设计解决方案？
* */
var __importDefault =
  (this && this.__importDefault) ||
  function (mod) {
    return mod && mod.__esModule ? mod : { default: mod };
  };
Object.defineProperty(exports, "__esModule", { value: true });
/*
class Solution {
    public int maxSumSubmatrix(int[][] matrix, int k) {
        int ans = Integer.MIN_VALUE;
        int m = matrix.length, n = matrix[0].length;
        for (int i = 0; i < m; ++i) { // 枚举上边界
            int[] sum = new int[n];
            for (int j = i; j < m; ++j) { // 枚举下边界
                for (int c = 0; c < n; ++c) {
                    sum[c] += matrix[j][c]; // 更新每列的元素和
                }
                TreeSet<Integer> sumSet = new TreeSet<Integer>();
                sumSet.add(0);
                int s = 0;
                for (int v : sum) {
                    s += v;
                    Integer ceil = sumSet.ceiling(s - k);
                    if (ceil != null) {
                        ans = Math.max(ans, s - ceil);
                    }
                    sumSet.add(s);
                }
            }
        }
        return ans;
    }
}
* */
function maxSumSubmatrix(matrix, k) {
  let ans = -Infinity;
  const m = matrix.length;
  const n = matrix[0].length;
  for (let i = 0; i < m; i++) {
    // 枚举上边界
    const sum = Array(n).fill(0);
    for (let j = i; j < m; j++) {
      // 枚举下边界
      for (let c = 0; c < n; c++) {
        sum[c] += matrix[j][c]; // 更新每列的元素和
      }
      const sumSet = new Set();
      sumSet.add(0);
      let s = 0;
      for (const v of sum) {
        s += v;
        // 找到 4 或者 > 4但是最接近4 的值
        // 其他语言中 有 treeSet(java) 或者 sortedList(python) 可以直接获取
        const ceil = binarySearch(
          [...sumSet].sort((a, b) => b - a),
          s - k
        );
        if (ceil != null) {
          ans = Math.max(ans, s - ceil);
        }
        sumSet.add(s);
      }
    }
  }
  return ans;
}
/**
 * 二分查找
 * */
function binarySearch(nums, target) {
  if (nums[0] < target) return null;
  let left = 0;
  let right = nums.length - 1;
  while (left <= right) {
    // 分成2份
    const criticalPoint = ~~((left + right) / 2);
    if (nums[criticalPoint] > target) {
      left = criticalPoint + 1;
    } else if (nums[criticalPoint] < target) {
      right = criticalPoint - 1;
    } else {
      return nums[criticalPoint];
    }
  }
  return nums[Math.max(left - 1, 0)];
}
function maxSumSubmatrix2(matrix, max) {
  let row = matrix.length; // 行
  let column = matrix[0].length; // 列
  let b = Array.from({ length: column }, () => 0); // 存储每列之和
  let res = -Number.MAX_VALUE;
  for (let i = 0; i < row; i++) {
    // 遍历开始行
    for (let t = 0; t < b.length; t++) b[t] = 0; // 开始行改变之后需要把每列之和置零
    for (let j = i; j < row; j++) {
      for (let k = 0; k < column; k++) b[k] += matrix[j][k];
      // 把所有可能遍历出来
      for (let m = 0; m < b.length; m++) {
        let sum = 0;
        for (let n = m; n < b.length; n++) {
          sum += b[n];
          if (sum <= max && sum > res) {
            // 只有小于max，且大于之前的值
            res = sum;
          }
        }
      }
    }
  }
  return res;
}
const assert_1 = __importDefault(require("assert"));
assert_1.default.strictEqual(binarySearch([6, 5, 3, 2, 1], 4), 5);
assert_1.default.strictEqual(binarySearch([5, 4, 3], 4), 4);
assert_1.default.strictEqual(binarySearch([5, 3, 2, 1], 4), 5);
assert_1.default.strictEqual(binarySearch([5, 3, 2, 1], 4), 5);
assert_1.default.strictEqual(binarySearch([5, 4, 3, 2, 1], 4), 4);
assert_1.default.strictEqual(binarySearch([4, 3, 2, 1], 4), 4);
assert_1.default.strictEqual(binarySearch([3, 2, 1], 4), null);
assert_1.default.strictEqual(binarySearch([6, 5], 4), 5);
// prettier-ignore
assert_1.default.strictEqual(maxSumSubmatrix([[1, 0, 1], [0, -2, 3]], 2), 2);
assert_1.default.strictEqual(maxSumSubmatrix([[2, 2, -1]], 3), 3);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzYzLuefqeW9ouWMuuWfn+S4jei2hei/h0vnmoTmnIDlpKfmlbDlgLzlkowuanMiLCJzb3VyY2VSb290IjoiLi8iLCJzb3VyY2VzIjpbImxlZXRjb2RlLzM2My7nn6nlvaLljLrln5/kuI3otoXov4dL55qE5pyA5aSn5pWw5YC85ZKMLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBOEJJOzs7OztBQUVKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUEyQkk7QUFFSixTQUFTLGVBQWUsQ0FBQyxNQUFrQixFQUFFLENBQVM7SUFDcEQsSUFBSSxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUM7SUFDcEIsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUN4QixNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQzNCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDMUIsUUFBUTtRQUNSLE1BQU0sR0FBRyxHQUFhLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQixRQUFRO1lBQ1IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDMUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVc7YUFDcEM7WUFFRCxNQUFNLE1BQU0sR0FBZ0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUN0QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FB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QyxDQUFDO0FBQ3JELGdCQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN4RCxnQkFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNyRCxnQkFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ3JELGdCQUFNLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUUvQyxrQkFBa0I7QUFDbEIsZ0JBQU0sQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDbkUsZ0JBQU0sQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4zNjMuIOefqeW9ouWMuuWfn+S4jei2hei/hyBLIOeahOacgOWkp+aVsOWAvOWSjFxu57uZ5L2g5LiA5LiqIG0geCBuIOeahOefqemYtSBtYXRyaXgg5ZKM5LiA5Liq5pW05pWwIGsg77yM5om+5Ye65bm26L+U5Zue55+p6Zi15YaF6YOo55+p5b2i5Yy65Z+f55qE5LiN6LaF6L+HIGsg55qE5pyA5aSn5pWw5YC85ZKM44CCXG5cbumimOebruaVsOaNruS/neivgeaAu+S8muWtmOWcqOS4gOS4quaVsOWAvOWSjOS4jei2hei/hyBrIOeahOefqeW9ouWMuuWfn+OAglxuXG5cblxu56S65L6LIDHvvJpcblxuXG7ovpPlhaXvvJptYXRyaXggPSBbWzEsMCwxXSxbMCwtMiwzXV0sIGsgPSAyXG7ovpPlh7rvvJoyXG7op6Pph4rvvJrok53oibLovrnmoYblnIjlh7rmnaXnmoTnn6nlvaLljLrln58gW1swLCAxXSwgWy0yLCAzXV0g55qE5pWw5YC85ZKM5pivIDLvvIzkuJQgMiDmmK/kuI3otoXov4cgayDnmoTmnIDlpKfmlbDlrZfvvIhrID0gMu+8ieOAglxu56S65L6LIDLvvJpcblxu6L6T5YWl77yabWF0cml4ID0gW1syLDIsLTFdXSwgayA9IDNcbui+k+WHuu+8mjNcblxuXG7mj5DnpLrvvJpcblxubSA9PSBtYXRyaXgubGVuZ3RoXG5uID09IG1hdHJpeFtpXS5sZW5ndGhcbjEgPD0gbSwgbiA8PSAxMDBcbi0xMDAgPD0gbWF0cml4W2ldW2pdIDw9IDEwMFxuLTEwNSA8PSBrIDw9IDEwNVxuXG5cbui/m+mYtu+8muWmguaenOihjOaVsOi/nOWkp+S6juWIl+aVsO+8jOivpeWmguS9leiuvuiuoeino+WGs+aWueahiO+8n1xuKiAqL1xuXG4vKlxuY2xhc3MgU29sdXRpb24ge1xuICAgIHB1YmxpYyBpbnQgbWF4U3VtU3VibWF0cml4KGludFtdW10gbWF0cml4LCBpbnQgaykge1xuICAgICAgICBpbnQgYW5zID0gSW50ZWdlci5NSU5fVkFMVUU7XG4gICAgICAgIGludCBtID0gbWF0cml4Lmxlbmd0aCwgbiA9IG1hdHJpeFswXS5sZW5ndGg7XG4gICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbTsgKytpKSB7IC8vIOaemuS4vuS4iui+ueeVjFxuICAgICAgICAgICAgaW50W10gc3VtID0gbmV3IGludFtuXTtcbiAgICAgICAgICAgIGZvciAoaW50IGogPSBpOyBqIDwgbTsgKytqKSB7IC8vIOaemuS4vuS4i+i+ueeVjFxuICAgICAgICAgICAgICAgIGZvciAoaW50IGMgPSAwOyBjIDwgbjsgKytjKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1bVtjXSArPSBtYXRyaXhbal1bY107IC8vIOabtOaWsOavj+WIl+eahOWFg+e0oOWSjFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBUcmVlU2V0PEludGVnZXI+IHN1bVNldCA9IG5ldyBUcmVlU2V0PEludGVnZXI+KCk7XG4gICAgICAgICAgICAgICAgc3VtU2V0LmFkZCgwKTtcbiAgICAgICAgICAgICAgICBpbnQgcyA9IDA7XG4gICAgICAgICAgICAgICAgZm9yIChpbnQgdiA6IHN1bSkge1xuICAgICAgICAgICAgICAgICAgICBzICs9IHY7XG4gICAgICAgICAgICAgICAgICAgIEludGVnZXIgY2VpbCA9IHN1bVNldC5jZWlsaW5nKHMgLSBrKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlaWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5zID0gTWF0aC5tYXgoYW5zLCBzIC0gY2VpbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3VtU2V0LmFkZChzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFucztcbiAgICB9XG59XG4qICovXG5cbmZ1bmN0aW9uIG1heFN1bVN1Ym1hdHJpeChtYXRyaXg6IG51bWJlcltdW10sIGs6IG51bWJlcik6IG51bWJlciB7XG4gIGxldCBhbnMgPSAtSW5maW5pdHk7XG4gIGNvbnN0IG0gPSBtYXRyaXgubGVuZ3RoO1xuICBjb25zdCBuID0gbWF0cml4WzBdLmxlbmd0aDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBtOyBpKyspIHtcbiAgICAvLyDmnprkuL7kuIrovrnnlYxcbiAgICBjb25zdCBzdW06IG51bWJlcltdID0gQXJyYXkobikuZmlsbCgwKTtcbiAgICBmb3IgKGxldCBqID0gaTsgaiA8IG07IGorKykge1xuICAgICAgLy8g5p6a5Li+5LiL6L6555WMXG4gICAgICBmb3IgKGxldCBjID0gMDsgYyA8IG47IGMrKykge1xuICAgICAgICBzdW1bY10gKz0gbWF0cml4W2pdW2NdOyAvLyDmm7TmlrDmr4/liJfnmoTlhYPntKDlkoxcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VtU2V0OiBTZXQ8bnVtYmVyPiA9IG5ldyBTZXQoKTtcbiAgICAgIHN1bVNldC5hZGQoMCk7XG4gICAgICBsZXQgcyA9IDA7XG4gICAgICBmb3IgKGNvbnN0IHYgb2Ygc3VtKSB7XG4gICAgICAgIHMgKz0gdjtcblxuICAgICAgICAvLyDmib7liLAgNCDmiJbogIUgPiA05L2G5piv5pyA5o6l6L+RNCDnmoTlgLxcbiAgICAgICAgLy8g5YW25LuW6K+t6KiA5LitIOaciSB0cmVlU2V0KGphdmEpIOaIluiAhSBzb3J0ZWRMaXN0KHB5dGhvbikg5Y+v5Lul55u05o6l6I635Y+WXG4gICAgICAgIGNvbnN0IGNlaWwgPSBiaW5hcnlTZWFyY2goXG4gICAgICAgICAgWy4uLnN1bVNldF0uc29ydCgoYSwgYikgPT4gYiAtIGEpLFxuICAgICAgICAgIHMgLSBrXG4gICAgICAgICk7XG4gICAgICAgIGlmIChjZWlsICE9IG51bGwpIHtcbiAgICAgICAgICBhbnMgPSBNYXRoLm1heChhbnMsIHMgLSBjZWlsKTtcbiAgICAgICAgfVxuICAgICAgICBzdW1TZXQuYWRkKHMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhbnM7XG59XG5cbi8qKlxuICog5LqM5YiG5p+l5om+XG4gKiAqL1xuZnVuY3Rpb24gYmluYXJ5U2VhcmNoKG51bXM6IG51bWJlcltdLCB0YXJnZXQ6IG51bWJlcikge1xuICBpZiAobnVtc1swXSA8IHRhcmdldCkgcmV0dXJuIG51bGw7XG4gIGxldCBsZWZ0ID0gMDtcbiAgbGV0IHJpZ2h0ID0gbnVtcy5sZW5ndGggLSAxO1xuICB3aGlsZSAobGVmdCA8PSByaWdodCkge1xuICAgIC8vIOWIhuaIkDLku71cbiAgICBjb25zdCBjcml0aWNhbFBvaW50ID0gfn4oKGxlZnQgKyByaWdodCkgLyAyKTtcbiAgICBpZiAobnVtc1tjcml0aWNhbFBvaW50XSA+IHRhcmdldCkge1xuICAgICAgbGVmdCA9IGNyaXRpY2FsUG9pbnQgKyAxO1xuICAgIH0gZWxzZSBpZiAobnVtc1tjcml0aWNhbFBvaW50XSA8IHRhcmdldCkge1xuICAgICAgcmlnaHQgPSBjcml0aWNhbFBvaW50IC0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bXNbY3JpdGljYWxQb2ludF07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG51bXNbTWF0aC5tYXgobGVmdCAtIDEsIDApXTtcbn1cblxuZnVuY3Rpb24gbWF4U3VtU3VibWF0cml4MihtYXRyaXg6IG51bWJlcltdW10sIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgbGV0IHJvdyA9IG1hdHJpeC5sZW5ndGg7IC8vIOihjFxuICBsZXQgY29sdW1uID0gbWF0cml4WzBdLmxlbmd0aDsgLy8g5YiXXG4gIGxldCBiID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29sdW1uIH0sICgpID0+IDApOyAvLyDlrZjlgqjmr4/liJfkuYvlkoxcbiAgbGV0IHJlcyA9IC1OdW1iZXIuTUFYX1ZBTFVFO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHJvdzsgaSsrKSB7XG4gICAgLy8g6YGN5Y6G5byA5aeL6KGMXG4gICAgZm9yIChsZXQgdCA9IDA7IHQgPCBiLmxlbmd0aDsgdCsrKSBiW3RdID0gMDsgLy8g5byA5aeL6KGM5pS55Y+Y5LmL5ZCO6ZyA6KaB5oqK5q+P5YiX5LmL5ZKM572u6Zu2XG4gICAgZm9yIChsZXQgaiA9IGk7IGogPCByb3c7IGorKykge1xuICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBjb2x1bW47IGsrKykgYltrXSArPSBtYXRyaXhbal1ba107XG4gICAgICAvLyDmiormiYDmnInlj6/og73pgY3ljoblh7rmnaVcbiAgICAgIGZvciAobGV0IG0gPSAwOyBtIDwgYi5sZW5ndGg7IG0rKykge1xuICAgICAgICBsZXQgc3VtID0gMDtcbiAgICAgICAgZm9yIChsZXQgbiA9IG07IG4gPCBiLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgc3VtICs9IGJbbl07XG4gICAgICAgICAgaWYgKHN1bSA8PSBtYXggJiYgc3VtID4gcmVzKSB7XG4gICAgICAgICAgICAvLyDlj6rmnInlsI/kuo5tYXjvvIzkuJTlpKfkuo7kuYvliY3nmoTlgLxcbiAgICAgICAgICAgIHJlcyA9IHN1bTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlcztcbn1cblxuaW1wb3J0IGFzc2VydCBmcm9tIFwiYXNzZXJ0XCI7XG5cbmFzc2VydC5zdHJpY3RFcXVhbChiaW5hcnlTZWFyY2goWzYsIDUsIDMsIDIsIDFdLCA0KSwgNSk7XG5hc3NlcnQuc3RyaWN0RXF1YWwoYmluYXJ5U2VhcmNoKFs1LCA0LCAzXSwgNCksIDQpO1xuYXNzZXJ0LnN0cmljdEVxdWFsKGJpbmFyeVNlYXJjaChbNSwgMywgMiwgMV0sIDQpLCA1KTtcbmFzc2VydC5zdHJpY3RFcXVhbChiaW5hcnlTZWFyY2goWzUsIDMsIDIsIDFdLCA0KSwgNSk7XG5hc3NlcnQuc3RyaWN0RXF1YWwoYmluYXJ5U2VhcmNoKFs1LCA0LCAzLCAyLCAxXSwgNCksIDQpO1xuYXNzZXJ0LnN0cmljdEVxdWFsKGJpbmFyeVNlYXJjaChbNCwgMywgMiwgMV0sIDQpLCA0KTtcbmFzc2VydC5zdHJpY3RFcXVhbChiaW5hcnlTZWFyY2goWzMsIDIsIDFdLCA0KSwgbnVsbCk7XG5hc3NlcnQuc3RyaWN0RXF1YWwoYmluYXJ5U2VhcmNoKFs2LCA1XSwgNCksIDUpO1xuXG4vLyBwcmV0dGllci1pZ25vcmVcbmFzc2VydC5zdHJpY3RFcXVhbChtYXhTdW1TdWJtYXRyaXgoW1sxLCAwLCAxXSwgWzAsIC0yLCAzXV0sIDIpLCAyKTtcbmFzc2VydC5zdHJpY3RFcXVhbChtYXhTdW1TdWJtYXRyaXgoW1syLCAyLCAtMV1dLCAzKSwgMyk7XG4iXX0=
