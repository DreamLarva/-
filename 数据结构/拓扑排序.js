"use strict";
/**
 * 能执行拓扑排序的必须是一个有序无环图
 * 如果有一个非有向无环图，且A点出发向B经C可回到A，形成一个环。将从C到A的边方向改为从A到C，则变成有向无环图。
 * 拓扑排序常用来确定一个依赖关系集中，事物发生的顺序。例如，在日常工作中，可能会将项目拆分成A、B、C、D四个子部分来完成，但A依赖于B和D，C依赖于D。为了计算这个项目进行的顺序，可对这个关系集进行拓扑排序，得出一个线性的序列，则排在前面的任务就是需要先完成的任务。
 注意：这里得到的排序并不是唯一的！就好像你早上穿衣服可以先穿上衣也可以先穿裤子，只要里面的衣服在外面的衣服之前穿就行。
 * */
Object.defineProperty(exports, "__esModule", { value: true });
class Graph {
    vertices;
    edges = 0;
    adj = [];
    vertexList = [];
    constructor(vertices) {
        this.vertices = vertices;
        for (let i = 0; i < this.vertices; ++i) {
            this.adj[i] = [];
            this.adj[i].push("");
        }
    }
    // 添 v 到 w 的边
    addEdge(v, w) {
        this.adj[v].push(w); // v 点 能到 w
        this.adj[w].push(v); // w 点 能到 v
        this.edges++;
    }
    showGraph() {
        const visited = [];
        let output = "";
        for (let i = 0; i < this.vertices; ++i) {
            output = this.vertexList[i] + " -> ";
            visited.push(this.vertexList[i]);
            for (let j = 0; j < this.vertices; ++j) {
                if (this.adj[i][j] !== undefined && this.adj[i][j] !== "") {
                    if (visited.indexOf(this.vertexList[this.adj[i][j]]) < 0) {
                        output += this.vertexList[j] + " ";
                    }
                }
            }
            console.log(output);
            visited.pop();
        }
    }
    // 深度优先搜索
    dfs(v) {
        const marked = Array(this.vertices).fill(false);
        const { adj } = this;
        step(v);
        function step(v) {
            marked[v] = true;
            if (adj[v] !== undefined) {
                console.log("访问了顶点" + v);
            }
            adj[v].forEach((v) => {
                if (v !== "" && !marked[v]) {
                    step(v);
                }
            });
        }
    }
    // 广度优先搜索
    bfs(s) {
        const edgeTo = [];
        const queue = [];
        const marked = Array(this.vertices).fill(false);
        marked[s] = true;
        queue.push(s);
        while (queue.length > 0) {
            const w = queue.shift();
            if (w !== undefined) {
                console.log("访问了节点 " + w);
            }
            this.adj[w].forEach((v) => {
                if (v !== "" && !marked[v]) {
                    console.log(v, w);
                    edgeTo[v] = w;
                    marked[v] = true;
                    queue.push(v);
                }
            });
        }
        // console.log(edgeTo);
        return { edgeTo, marked };
    }
    // 最短路径
    pathTo(start, end) {
        // 如果是start开始的顶点 返回的edgeTo[start]一定等于undefined
        const { marked, edgeTo } = this.bfs(start);
        if (!marked[end]) {
            // 避免要到达的顶点其实并没有连接
            return undefined;
        }
        const path = [];
        // 一旦路径到达start 说明已经完成即停止循环
        for (let i = end; i != start; i = edgeTo[i]) {
            path.push(i);
        }
        path.push(start);
        return path.reverse();
    }
    // 拓扑排序
    topSort() {
        const stack = [];
        const visited = [];
        for (let i = 0; i < this.vertices; i++) {
            visited[i] = false;
        }
        for (let i = 0; i < this.vertices; i++) {
            if (!visited[i]) {
                this.topSortHelper(i, visited, stack);
            }
        }
        for (let i = 0; i < stack.length; i++) {
            if (stack[i] !== undefined && stack[i] !== false) {
                console.log(this.vertexList[stack[i]]);
            }
        }
    }
    topSortHelper(v, visited, stack) {
        visited[v] = true;
        this.adj[v].forEach((v, i, a) => {
            // 对于每个顶点的领接顶点 如果他已经没有其他顶点则推入栈中
            if (v !== "" && !visited[v]) {
                this.topSortHelper.call(this, v, visited, stack);
            }
        });
        stack.push(v);
    }
}
const g = new Graph(6);
g.addEdge(1, 2);
g.addEdge(2, 5);
g.addEdge(1, 3);
g.addEdge(2, 4);
g.addEdge(0, 1);
g.vertexList = [
    "CS1",
    "CS2",
    "Data Structures",
    "Assembly Language",
    "Operating Systems",
    "Algorithms",
];
g.showGraph();
console.log("拓扑排序");
g.topSort();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoi5ouT5omR5o6S5bqPLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyLmlbDmja7nu5PmnoQv5ouT5omR5o6S5bqPLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7S0FLSzs7QUFFTCxNQUFNLEtBQUs7SUFLVTtJQUpuQixLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsR0FBRyxHQUFzQixFQUFFLENBQUM7SUFDNUIsVUFBVSxHQUFhLEVBQUUsQ0FBQztJQUUxQixZQUFtQixRQUFnQjtRQUFoQixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3RCO0lBQ0gsQ0FBQztJQUVELGFBQWE7SUFDYixPQUFPLENBQUMsQ0FBUyxFQUFFLENBQVM7UUFDMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXO1FBQ2hDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVztRQUNoQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDO0lBRUQsU0FBUztRQUNQLE1BQU0sT0FBTyxHQUFhLEVBQUUsQ0FBQztRQUM3QixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDdEMsTUFBTSxHQUFHLElBQUks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dkIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQyxDQUFDLFVBQVUsR0FBRztJQUNiLEtBQUs7SUFDTCxLQUFLO0lBQ0wsaUJBQWlCO0lBQ2pCLG1CQUFtQjtJQUNuQixtQkFBbUI7SUFDbkIsWUFBWTtDQUNiLENBQUM7QUFDRixDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7QUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3BCLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog6IO95omn6KGM5ouT5omR5o6S5bqP55qE5b+F6aG75piv5LiA5Liq5pyJ5bqP5peg546v5Zu+XG4gKiDlpoLmnpzmnInkuIDkuKrpnZ7mnInlkJHml6Dnjq/lm77vvIzkuJRB54K55Ye65Y+R5ZCRQue7j0Plj6/lm57liLBB77yM5b2i5oiQ5LiA5Liq546v44CC5bCG5LuOQ+WIsEHnmoTovrnmlrnlkJHmlLnkuLrku45B5YiwQ++8jOWImeWPmOaIkOacieWQkeaXoOeOr+WbvuOAglxuICog5ouT5omR5o6S5bqP5bi455So5p2l56Gu5a6a5LiA5Liq5L6d6LWW5YWz57O76ZuG5Lit77yM5LqL54mp5Y+R55Sf55qE6aG65bqP44CC5L6L5aaC77yM5Zyo5pel5bi45bel5L2c5Lit77yM5Y+v6IO95Lya5bCG6aG555uu5ouG5YiG5oiQQeOAgULjgIFD44CBROWbm+S4quWtkOmDqOWIhuadpeWujOaIkO+8jOS9hkHkvp3otZbkuo5C5ZKMRO+8jEPkvp3otZbkuo5E44CC5Li65LqG6K6h566X6L+Z5Liq6aG555uu6L+b6KGM55qE6aG65bqP77yM5Y+v5a+56L+Z5Liq5YWz57O76ZuG6L+b6KGM5ouT5omR5o6S5bqP77yM5b6X5Ye65LiA5Liq57q/5oCn55qE5bqP5YiX77yM5YiZ5o6S5Zyo5YmN6Z2i55qE5Lu75Yqh5bCx5piv6ZyA6KaB5YWI5a6M5oiQ55qE5Lu75Yqh44CCXG4g5rOo5oSP77ya6L+Z6YeM5b6X5Yiw55qE5o6S5bqP5bm25LiN5piv5ZSv5LiA55qE77yB5bCx5aW95YOP5L2g5pep5LiK56m/6KGj5pyN5Y+v5Lul5YWI56m/5LiK6KGj5Lmf5Y+v5Lul5YWI56m/6KOk5a2Q77yM5Y+q6KaB6YeM6Z2i55qE6KGj5pyN5Zyo5aSW6Z2i55qE6KGj5pyN5LmL5YmN56m/5bCx6KGM44CCXG4gKiAqL1xuXG5jbGFzcyBHcmFwaCB7XG4gIGVkZ2VzID0gMDtcbiAgYWRqOiAobnVtYmVyIHwgXCJcIilbXVtdID0gW107XG4gIHZlcnRleExpc3Q6IHN0cmluZ1tdID0gW107XG5cbiAgY29uc3RydWN0b3IocHVibGljIHZlcnRpY2VzOiBudW1iZXIpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXM7ICsraSkge1xuICAgICAgdGhpcy5hZGpbaV0gPSBbXTtcbiAgICAgIHRoaXMuYWRqW2ldLnB1c2goXCJcIik7XG4gICAgfVxuICB9XG5cbiAgLy8g5re7IHYg5YiwIHcg55qE6L65XG4gIGFkZEVkZ2UodjogbnVtYmVyLCB3OiBudW1iZXIpIHtcbiAgICB0aGlzLmFkalt2XS5wdXNoKHcpOyAvLyB2IOeCuSDog73liLAgd1xuICAgIHRoaXMuYWRqW3ddLnB1c2godik7IC8vIHcg54K5IOiDveWIsCB2XG4gICAgdGhpcy5lZGdlcysrO1xuICB9XG5cbiAgc2hvd0dyYXBoKCkge1xuICAgIGNvbnN0IHZpc2l0ZWQ6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IG91dHB1dCA9IFwiXCI7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzOyArK2kpIHtcbiAgICAgIG91dHB1dCA9IHRoaXMudmVydGV4TGlzdFtpXSArIFwiIC0+IFwiO1xuICAgICAgdmlzaXRlZC5wdXNoKHRoaXMudmVydGV4TGlzdFtpXSk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMudmVydGljZXM7ICsraikge1xuICAgICAgICBpZiAodGhpcy5hZGpbaV1bal0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLmFkaltpXVtqXSAhPT0gXCJcIikge1xuICAgICAgICAgIGlmICh2aXNpdGVkLmluZGV4T2YodGhpcy52ZXJ0ZXhMaXN0WzxudW1iZXI+dGhpcy5hZGpbaV1bal1dKSA8IDApIHtcbiAgICAgICAgICAgIG91dHB1dCArPSB0aGlzLnZlcnRleExpc3Rbal0gKyBcIiBcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKG91dHB1dCk7XG4gICAgICB2aXNpdGVkLnBvcCgpO1xuICAgIH1cbiAgfVxuXG4gIC8vIOa3seW6puS8mOWFiOaQnOe0olxuICBkZnModjogbnVtYmVyKSB7XG4gICAgY29uc3QgbWFya2VkID0gQXJyYXkodGhpcy52ZXJ0aWNlcykuZmlsbChmYWxzZSk7XG4gICAgY29uc3QgeyBhZGogfSA9IHRoaXM7XG4gICAgc3RlcCh2KTtcblxuICAgIGZ1bmN0aW9uIHN0ZXAodjogbnVtYmVyKSB7XG4gICAgICBtYXJrZWRbdl0gPSB0cnVlO1xuICAgICAgaWYgKGFkalt2XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwi6K6/6Zeu5LqG6aG254K5XCIgKyB2KTtcbiAgICAgIH1cbiAgICAgIGFkalt2XS5mb3JFYWNoKCh2KSA9PiB7XG4gICAgICAgIGlmICh2ICE9PSBcIlwiICYmICFtYXJrZWRbdl0pIHtcbiAgICAgICAgICBzdGVwKHYpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyDlub/luqbkvJjlhYjmkJzntKJcbiAgYmZzKHM6IG51bWJlcikge1xuICAgIGNvbnN0IGVkZ2VUbzogbnVtYmVyW10gPSBbXTtcbiAgICBjb25zdCBxdWV1ZTogbnVtYmVyW10gPSBbXTtcbiAgICBjb25zdCBtYXJrZWQgPSBBcnJheSh0aGlzLnZlcnRpY2VzKS5maWxsKGZhbHNlKTtcbiAgICBtYXJrZWRbc10gPSB0cnVlO1xuICAgIHF1ZXVlLnB1c2gocyk7XG5cbiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgdyA9IHF1ZXVlLnNoaWZ0KCkhO1xuICAgICAgaWYgKHcgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIuiuv+mXruS6huiKgueCuSBcIiArIHcpO1xuICAgICAgfVxuICAgICAgdGhpcy5hZGpbd10uZm9yRWFjaCgodikgPT4ge1xuICAgICAgICBpZiAodiAhPT0gXCJcIiAmJiAhbWFya2VkW3ZdKSB7XG4gICAgICAgICAgY29uc29sZS5sb2codiwgdyk7XG4gICAgICAgICAgZWRnZVRvW3ZdID0gdztcbiAgICAgICAgICBtYXJrZWRbdl0gPSB0cnVlO1xuICAgICAgICAgIHF1ZXVlLnB1c2godik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhlZGdlVG8pO1xuICAgIHJldHVybiB7IGVkZ2VUbywgbWFya2VkIH07XG4gIH1cblxuICAvLyDmnIDnn63ot6/lvoRcbiAgcGF0aFRvKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG4gICAgLy8g5aaC5p6c5pivc3RhcnTlvIDlp4vnmoTpobbngrkg6L+U5Zue55qEZWRnZVRvW3N0YXJ0XeS4gOWumuetieS6jnVuZGVmaW5lZFxuICAgIGNvbnN0IHsgbWFya2VkLCBlZGdlVG8gfSA9IHRoaXMuYmZzKHN0YXJ0KTtcblxuICAgIGlmICghbWFya2VkW2VuZF0pIHtcbiAgICAgIC8vIOmBv+WFjeimgeWIsOi+vueahOmhtueCueWFtuWunuW5tuayoeaciei/nuaOpVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29uc3QgcGF0aCA9IFtdO1xuICAgIC8vIOS4gOaXpui3r+W+hOWIsOi+vnN0YXJ0IOivtOaYjuW3sue7j+WujOaIkOWNs+WBnOatouW+queOr1xuICAgIGZvciAobGV0IGkgPSBlbmQ7IGkgIT0gc3RhcnQ7IGkgPSBlZGdlVG9baV0pIHtcbiAgICAgIHBhdGgucHVzaChpKTtcbiAgICB9XG4gICAgcGF0aC5wdXNoKHN0YXJ0KTtcbiAgICByZXR1cm4gcGF0aC5yZXZlcnNlKCk7XG4gIH1cblxuICAvLyDmi5PmiZHmjpLluo9cbiAgdG9wU29ydCgpIHtcbiAgICBjb25zdCBzdGFjazogKGZhbHNlIHwgbnVtYmVyKVtdID0gW107XG4gICAgY29uc3QgdmlzaXRlZDogYm9vbGVhbltdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzOyBpKyspIHtcbiAgICAgIHZpc2l0ZWRbaV0gPSBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnZlcnRpY2VzOyBpKyspIHtcbiAgICAgIGlmICghdmlzaXRlZFtpXSkge1xuICAgICAgICB0aGlzLnRvcFNvcnRIZWxwZXIoaSwgdmlzaXRlZCwgc3RhY2spO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0YWNrLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoc3RhY2tbaV0gIT09IHVuZGVmaW5lZCAmJiBzdGFja1tpXSAhPT0gZmFsc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy52ZXJ0ZXhMaXN0WzxudW1iZXI+c3RhY2tbaV1dKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0b3BTb3J0SGVscGVyKHY6IG51bWJlciwgdmlzaXRlZDogYm9vbGVhbltdLCBzdGFjazogYW55W10pIHtcbiAgICB2aXNpdGVkW3ZdID0gdHJ1ZTtcblxuICAgIHRoaXMuYWRqW3ZdLmZvckVhY2goKHYsIGksIGEpID0+IHtcbiAgICAgIC8vIOWvueS6juavj+S4qumhtueCueeahOmihuaOpemhtueCuSDlpoLmnpzku5blt7Lnu4/msqHmnInlhbbku5bpobbngrnliJnmjqjlhaXmoIjkuK1cbiAgICAgIGlmICh2ICE9PSBcIlwiICYmICF2aXNpdGVkW3ZdKSB7XG4gICAgICAgIHRoaXMudG9wU29ydEhlbHBlci5jYWxsKHRoaXMsIHYsIHZpc2l0ZWQsIHN0YWNrKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzdGFjay5wdXNoKHYpO1xuICB9XG59XG5cbmNvbnN0IGcgPSBuZXcgR3JhcGgoNik7XG5nLmFkZEVkZ2UoMSwgMik7XG5nLmFkZEVkZ2UoMiwgNSk7XG5nLmFkZEVkZ2UoMSwgMyk7XG5nLmFkZEVkZ2UoMiwgNCk7XG5nLmFkZEVkZ2UoMCwgMSk7XG5nLnZlcnRleExpc3QgPSBbXG4gIFwiQ1MxXCIsXG4gIFwiQ1MyXCIsXG4gIFwiRGF0YSBTdHJ1Y3R1cmVzXCIsXG4gIFwiQXNzZW1ibHkgTGFuZ3VhZ2VcIixcbiAgXCJPcGVyYXRpbmcgU3lzdGVtc1wiLFxuICBcIkFsZ29yaXRobXNcIixcbl07XG5nLnNob3dHcmFwaCgpO1xuY29uc29sZS5sb2coXCLmi5PmiZHmjpLluo9cIik7XG5nLnRvcFNvcnQoKTtcblxuZXhwb3J0IHt9O1xuIl19